import{i as e,j as a,d as l,E as o,c as n,e as s,f as r,h as t,_ as i}from"./add-circle-line-DNrxOMxR.js";import{l as p,s as u,ao as m,b3 as d,B as c,d as f,z as _,b2 as h,W as b,o as v,X as g,a3 as y,w as j,a as w,aC as k,Z as C,I as V,an as x,c as z,b4 as I,$ as R,b5 as E,af as U,a9 as $,ad as O,aJ as P,aw as S,Y as A}from"./index-Di92kVg-.js";import"./el-checkbox-B7yQgfNd.js";import"./el-tooltip-Cqo1nrH7.js";import"./el-scrollbar-CEu2sRdw.js";import"./el-tag-DSKcOb6W.js";import{E as B,a as J}from"./el-select-CzlwI2Yt.js";import{a as M,E as T}from"./el-form-item-Djx4fugC.js";import{E as W}from"./el-input-DdcZBZks.js";import{u as X}from"./hooks-DfIh1ubC.js";import{_ as q}from"./index.vue_vue_type_script_setup_true_lang-Cze6-mQ5.js";import{E as D}from"./el-divider-CtIiz4Je.js";import"./index-BLqJGsU7.js";import"./el-space-CQZsxoKg.js";import"./isEqual-CMs4GUR2.js";import"./token-DWNpOE8r.js";import"./castArray-hGVQffrX.js";import"./typescript-CRqm1_SZ.js";import"./inconifyIconOffline-BMvA4OKG.js";import"./el-row-BAQIrm2q.js";import"./el-radio-CzDU5RX3.js";import"./el-col-c_F0MUuZ.js";const F=u({username:"",phone:"",deptname:""}),K=u({total:0,pageSize:10,currentPage:1,background:!0}),L=p(!0),N=p([]);async function Q(){L.value=!0;const{data:a}=await e(m(F));N.value=a.list,K.total=a.total,K.pageSize=a.pageSize,K.currentPage=a.currentPage,setTimeout((()=>{L.value=!1}),500)}const Y=e=>{e&&(e.resetFields(),Q())},Z=[{label:"用户名",prop:"username"},{label:"手机号码",prop:"phone"},{label:"所在部门",prop:"deptname.name"},{label:"角色",prop:"role"}],G=p(),H=p();function ee(e="新增",a){d({title:`${e}用户`,props:{formInline:{higherDeptOptions:H.value,parentId:(null==a?void 0:a.parentId)??0,title:e,username:(null==a?void 0:a.username)??"",phone:(null==a?void 0:a.phone)??"",deptname:(null==a?void 0:a.deptname)??"",role:(null==a?void 0:a.role)??""}},width:"46%",draggable:!0,closeOnClickModal:!1,contentRender:()=>c(q,{ref:G,formInline:null}),beforeSure:(a,{options:l})=>{const o=G.value.getRef(),n=l.props.formInline;function s(){D.success(`您${e}了用户名称为${n.username}的这条数据`),a(),Q()}o.validate((e=>{e&&s()}))}})}function ae(e){D.success(`您删除了用户编号为${e.id}的这条数据`),Q()}const le={class:A(["flex"])},oe={style:{width:"100%"}},ne=f({__name:"index",setup(e){const u=p(),m=[{value:"admin",label:"管理员角色"},{value:"common",label:"普通角色"}];return _((async()=>{Q();const{data:e}=await a();H.value=h(e)})),(e,a)=>{const p=W,d=M,c=k,f=T,_=J,h=B,A=n,q=E,D=o,K=i;return v(),b("div",le,[g("div",oe,[y(f,{ref_key:"formRef",ref:u,inline:!0,model:w(F),class:"search-form bg-bg_color w-[99/100] pl-8 pt-[12px] overflow-auto"},{default:j((()=>[y(d,{label:"用户名称：",prop:"username"},{default:j((()=>[y(p,{modelValue:w(F).username,"onUpdate:modelValue":a[0]||(a[0]=e=>w(F).username=e),placeholder:"请输入用户名称",clearable:"",class:"!w-[180px]"},null,8,["modelValue"])])),_:1}),y(d,{label:"手机号码：",prop:"phone"},{default:j((()=>[y(p,{modelValue:w(F).phone,"onUpdate:modelValue":a[1]||(a[1]=e=>w(F).phone=e),placeholder:"请输入手机号码",clearable:"",class:"!w-[180px]"},null,8,["modelValue"])])),_:1}),y(d,{label:"部门名称：",prop:"name"},{default:j((()=>[y(p,{modelValue:w(F).deptname,"onUpdate:modelValue":a[2]||(a[2]=e=>w(F).deptname=e),placeholder:"请输入部门名称",clearable:"",class:"!w-[180px]"},null,8,["modelValue"])])),_:1}),y(d,null,{default:j((()=>[y(c,{type:"primary",icon:w(X)("ri:search-line"),loading:w(L),onClick:w(Q)},{default:j((()=>a[5]||(a[5]=[C(" 搜索 ")]))),_:1,__:[5]},8,["icon","loading","onClick"]),y(c,{icon:w(X)(w(l)),onClick:a[3]||(a[3]=e=>w(Y)(u.value))},{default:j((()=>a[6]||(a[6]=[C(" 重置 ")]))),_:1,__:[6]},8,["icon"])])),_:1})])),_:1},8,["model"]),y(K,{title:"用户权限",columns:w(Z),onRefresh:w(Q)},{buttons:j((()=>[y(c,{type:"primary",icon:w(X)(w(t)),onClick:a[4]||(a[4]=e=>w(ee)())},{default:j((()=>a[7]||(a[7]=[C(" 新增用户 ")]))),_:1,__:[7]},8,["icon"])])),default:j((({size:e,dynamicColumns:l})=>[y(D,{data:w(N),height:"250",style:{width:"100%"},ref:"tableRef"},{default:j((()=>[(v(!0),b(V,null,x(l,(e=>(v(),z(A,{key:e.prop,prop:e.prop,label:e.label,type:e.type,align:"center",formatter:e.formatter},I({_:2},["role"===e.prop?{name:"default",fn:j((({row:e})=>[y(h,{modelValue:e.role,"onUpdate:modelValue":a=>e.role=a,class:"!w-[160px]",onChange:a=>function(e,a){a.username===U().nickname&&($.clear(),O().clearAllCachePage(),U().loginByUsername({username:U().username,password:"admin123",roles:[e]}).then((e=>{if(e.success)return P().then((()=>{S.push("/").then((()=>{window.location.reload()}))}))})))}(a,e)},{default:j((()=>[(v(),b(V,null,x(m,(e=>y(_,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),64))])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])),key:"0"}:{name:"default",fn:j((a=>{return[C(R((l=a.row,o=e.prop,o.split(".").reduce(((e,a)=>e&&e[a]),l))),1)];var l,o})),key:"1"}]),1032,["prop","label","type","formatter"])))),128)),y(A,{fixed:"right",label:"Operations","min-width":"120"},{default:j((({row:l})=>[y(c,{class:"reset-margin",link:"",type:"primary",size:e,icon:w(X)(w(s)),onClick:e=>w(ee)("修改",l)},{default:j((()=>a[8]||(a[8]=[C(" 修改 ")]))),_:2,__:[8]},1032,["size","icon","onClick"]),y(q,{title:`是否确认删除用户编号为${l.id}的这条数据`,onConfirm:e=>w(ae)(l)},{reference:j((()=>[y(c,{class:"reset-margin",link:"",type:"primary",size:e,icon:w(X)(w(r))},{default:j((()=>a[9]||(a[9]=[C(" 删除 ")]))),_:2,__:[9]},1032,["size","icon"])])),_:2},1032,["title","onConfirm"])])),_:2},1024)])),_:2},1032,["data"])])),_:1},8,["columns","onRefresh"])])])}}});export{ne as default};
