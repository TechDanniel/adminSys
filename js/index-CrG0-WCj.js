import{i as e,j as a,d as l,E as o,c as n,e as s,f as r,h as t,_ as i}from"./add-circle-line-BDU1sDx4.js";import{l as p,q as u,as as m,b7 as d,A as c,d as f,y as h,b6 as b,V as _,o as v,W as y,a9 as g,w as j,a as w,aG as k,Y as V,H as C,ar as x,c as z,b8 as I,Z as R,b9 as E,ak as U,ae as A,ai as $,aN as O,aA as P,X as S}from"./index-B_o8siDq.js";import"./el-checkbox-VUoa7duk.js";import"./el-tooltip-B01_nTLm.js";import"./el-scrollbar-Dkahi5v9.js";import"./el-tag-BiUEjuzt.js";import{E as q,a as M}from"./el-select-ChqbmI9X.js";import{a as N,E as T}from"./el-form-item-jwksQNZh.js";import{E as W}from"./el-input-Cf2eIeua.js";import{u as X}from"./hooks-Br3HlGQj.js";import{_ as B}from"./index.vue_vue_type_script_setup_true_lang-DD9yWZKS.js";import{E as D}from"./el-divider-CsesGZGr.js";import"./index-CneRhBR0.js";import"./el-space-1hjCJYd_.js";import"./isEqual-CcbjmHFc.js";import"./token-DWNpOE8r.js";import"./castArray-Doute4CP.js";import"./typescript-CRqm1_SZ.js";import"./inconifyIconOffline-CFYy2gvx.js";import"./el-row-BeMIhmV4.js";import"./el-radio-BCzj3Wry.js";import"./el-col-CPQ7RoNE.js";const F=u({username:"",phone:"",deptname:""}),G=u({total:0,pageSize:10,currentPage:1,background:!0}),H=p(!0),J=p([]);async function K(){H.value=!0;const{data:a}=await e(m(F));J.value=a.list,G.total=a.total,G.pageSize=a.pageSize,G.currentPage=a.currentPage,setTimeout((()=>{H.value=!1}),500)}const L=e=>{e&&(e.resetFields(),K())},Q=[{label:"用户名",prop:"username"},{label:"手机号码",prop:"phone"},{label:"所在部门",prop:"deptname.name"},{label:"角色",prop:"role"}],Y=p(),Z=p();function ee(e="新增",a){d({title:`${e}用户`,props:{formInline:{higherDeptOptions:Z.value,parentId:(null==a?void 0:a.parentId)??0,title:e,username:(null==a?void 0:a.username)??"",phone:(null==a?void 0:a.phone)??"",deptname:(null==a?void 0:a.deptname)??"",role:(null==a?void 0:a.role)??""}},width:"46%",draggable:!0,closeOnClickModal:!1,contentRender:()=>c(B,{ref:Y,formInline:null}),beforeSure:(a,{options:l})=>{const o=Y.value.getRef(),n=l.props.formInline;function s(){D.success(`您${e}了用户名称为${n.username}的这条数据`),a(),K()}o.validate((e=>{e&&s()}))}})}function ae(e){D.success(`您删除了用户编号为${e.id}的这条数据`),K()}const le={class:S(["flex"])},oe={style:{width:"100%"}},ne=f({__name:"index",setup(e){const u=p(),m=[{value:"admin",label:"管理员角色"},{value:"common",label:"普通角色"}];return h((async()=>{K();const{data:e}=await a();Z.value=b(e)})),(e,a)=>{const p=W,d=N,c=k,f=T,h=M,b=q,S=n,B=E,D=o,G=i;return v(),_("div",le,[y("div",oe,[g(f,{ref_key:"formRef",ref:u,inline:!0,model:w(F),class:"search-form bg-bg_color w-[99/100] pl-8 pt-[12px] overflow-auto"},{default:j((()=>[g(d,{label:"用户名称：",prop:"username"},{default:j((()=>[g(p,{modelValue:w(F).username,"onUpdate:modelValue":a[0]||(a[0]=e=>w(F).username=e),placeholder:"请输入用户名称",clearable:"",class:"!w-[180px]"},null,8,["modelValue"])])),_:1}),g(d,{label:"手机号码：",prop:"phone"},{default:j((()=>[g(p,{modelValue:w(F).phone,"onUpdate:modelValue":a[1]||(a[1]=e=>w(F).phone=e),placeholder:"请输入手机号码",clearable:"",class:"!w-[180px]"},null,8,["modelValue"])])),_:1}),g(d,{label:"部门名称：",prop:"name"},{default:j((()=>[g(p,{modelValue:w(F).deptname,"onUpdate:modelValue":a[2]||(a[2]=e=>w(F).deptname=e),placeholder:"请输入部门名称",clearable:"",class:"!w-[180px]"},null,8,["modelValue"])])),_:1}),g(d,null,{default:j((()=>[g(c,{type:"primary",icon:w(X)("ri:search-line"),loading:w(H),onClick:w(K)},{default:j((()=>a[5]||(a[5]=[V(" 搜索 ")]))),_:1},8,["icon","loading","onClick"]),g(c,{icon:w(X)(w(l)),onClick:a[3]||(a[3]=e=>w(L)(u.value))},{default:j((()=>a[6]||(a[6]=[V(" 重置 ")]))),_:1},8,["icon"])])),_:1})])),_:1},8,["model"]),g(G,{title:"用户权限",columns:w(Q),onRefresh:w(K)},{buttons:j((()=>[g(c,{type:"primary",icon:w(X)(w(t)),onClick:a[4]||(a[4]=e=>w(ee)())},{default:j((()=>a[7]||(a[7]=[V(" 新增用户 ")]))),_:1},8,["icon"])])),default:j((({size:e,dynamicColumns:l})=>[g(D,{data:w(J),height:"250",style:{width:"100%"},ref:"tableRef"},{default:j((()=>[(v(!0),_(C,null,x(l,(e=>(v(),z(S,{key:e.prop,prop:e.prop,label:e.label,type:e.type,align:"center",formatter:e.formatter},I({_:2},["role"===e.prop?{name:"default",fn:j((({row:e})=>[g(b,{modelValue:e.role,"onUpdate:modelValue":a=>e.role=a,class:"!w-[160px]",onChange:a=>function(e,a){a.username===U().nickname&&(A.clear(),$().clearAllCachePage(),U().loginByUsername({username:U().username,password:"admin123",roles:[e]}).then((e=>{if(e.success)return O().then((()=>{P.push("/").then((()=>{window.location.reload()}))}))})))}(a,e)},{default:j((()=>[(v(),_(C,null,x(m,(e=>g(h,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),64))])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])),key:"0"}:{name:"default",fn:j((a=>{return[V(R((l=a.row,o=e.prop,o.split(".").reduce(((e,a)=>e&&e[a]),l))),1)];var l,o})),key:"1"}]),1032,["prop","label","type","formatter"])))),128)),g(S,{fixed:"right",label:"Operations","min-width":"120"},{default:j((({row:l})=>[g(c,{class:"reset-margin",link:"",type:"primary",size:e,icon:w(X)(w(s)),onClick:e=>w(ee)("修改",l)},{default:j((()=>a[8]||(a[8]=[V(" 修改 ")]))),_:2},1032,["size","icon","onClick"]),g(B,{title:`是否确认删除用户编号为${l.id}的这条数据`,onConfirm:e=>w(ae)(l)},{reference:j((()=>[g(c,{class:"reset-margin",link:"",type:"primary",size:e,icon:w(X)(w(r))},{default:j((()=>a[9]||(a[9]=[V(" 删除 ")]))),_:2},1032,["size","icon"])])),_:2},1032,["title","onConfirm"])])),_:2},1024)])),_:2},1032,["data"])])),_:1},8,["columns","onRefresh"])])])}}});export{ne as default};
