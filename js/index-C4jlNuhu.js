import{d as e,A as t,aD as a,q as i,l,f as s,aE as n,y as r,z as o,s as u,V as h,o as d,H as c,W as g,a9 as v,a as m,a6 as p,ar as f,w as y,S as w,r as _,aF as b,c as H,aq as x,F as q,aG as k,Y as z,Z as F,at as C}from"./index-B_o8siDq.js";import{E}from"./el-card-B3AWcSqn.js";import{E as S}from"./el-space-1hjCJYd_.js";import{E as W,b as $}from"./back_top-CatZxRVG.js";import{_ as A}from"./_plugin-vue_export-helper-BCo6x5W8.js";const I=e({name:"Auth",props:{value:{type:void 0,default:[]}},setup:(e,{slots:i})=>()=>i&&a(e.value)?t("Fragment",null,null==i?void 0:i.default()):null}),M=i({loading:!1,isFinish:!1,currentPage:1,list:[]});const R={key:1,id:"temporary-list"},j=A(e({__name:"index",props:{gap:{},column:{},pageSize:{},request:{type:Function},enterSize:{}},setup(e){const t=e,a=l(null),b=i({viewWidth:0,viewHeight:0,start:0}),H=s((()=>b.viewHeight+b.start)),x=l([]),q=l(!1),k=i({queue:Array(t.column).fill(0).map((()=>({list:[],height:0}))),len:0}),z=s((()=>{let e=0,t=1/0,a=-1/0;return k.queue.forEach((({height:i},l)=>{i<t&&(t=i,e=l),i>a&&(a=i)})),{minIndex:e,minHeight:t,maxHeight:a}})),F=s((()=>({height:`${z.value.maxHeight}px`}))),C=s((()=>k.len<M.list.length)),E=s((()=>k.queue.reduce(((e,{list:t})=>e.concat(t)),[]))),S=s((()=>E.value.filter((e=>e.h+e.y>b.start&&e.y<H.value)))),A=(e,a,i)=>{const l=I.value.get(e.id),s=l.width,n=l.height;let r=0;return null!==a&&(r=a.y+a.h+t.gap),{item:e,y:r,h:n,imageHeight:l.imageHeight,style:{width:`${s}px`,height:`${n}px`,transform:`translate3d(${0===i?0:(s+t.gap)*i}px,${r}px,0)`}}},I=l(new Map),j=()=>{I.value=M.list.reduce(((e,a)=>{const i=Math.floor((b.viewWidth-t.gap*(t.column-1))/t.column),l=I.value.get(a.id);return e.set(a.id,{width:i,height:l?l.height:0,imageHeight:Math.floor(i*a.height/a.width)}),e}),new Map)},T=(e=t.enterSize)=>{if(C.value){q.value=!1;for(let t=0;t<e;t++){const e=M.list[k.len+t];if(!e)break;const a=I.value.get(e.id);x.value.push({item:e,y:0,h:0,imageHeight:a.imageHeight,style:{width:`${a.width}px`}})}w((()=>{const e=document.querySelector("#temporary-list");Array.from(e.children).forEach(((e,t)=>{const a=e.getBoundingClientRect();x.value[t].h=a.height})),P(),q.value=!0,(e=>{for(let t=0;t<e;t++){const e=z.value.minIndex,t=k.queue[e],a=t.list[t.list.length-1]||null,i=M.list[k.len]||null;if(i){const l=A(i,a,e);t.list.push(l),t.height=l.y,k.len++}}})(x.value.length),x.value=[]}))}},P=()=>{x.value.forEach((({item:e,h:t})=>{const a=I.value.get(e.id);I.value.set(e.id,{...a,height:t})}))},D=async()=>{b.viewWidth=a.value.clientWidth,b.viewHeight=a.value.clientHeight,b.start=a.value.scrollTop},O=async()=>{if(M.isFinish)return;M.loading=!0;const e=await t.request(M.currentPage++,t.pageSize);if(e.length)return M.list.push(...e),M.loading=!1,e;M.isFinish=!0},B=function(e,t){let a=null;return function(...i){a||(e.apply(this,i),a=setTimeout((()=>{a=null}),t))}}((()=>{const{scrollTop:e,clientHeight:t}=a.value;b.start=e,M.loading||C.value||O().then((e=>{e&&j(),e&&T()})),e+t>z.value.minHeight&&T()}),1e3),G=n((()=>{D(),k.queue=Array(t.column).fill(0).map((()=>({list:[],height:0}))),k.len=0,j(),T(t.pageSize)}),300),V=new ResizeObserver((()=>{G()}));return r((async()=>{(async()=>{D();const e=await O();j(),e&&T(e.length)})(),V.observe(a.value)})),o((()=>{V.unobserve(a.value)})),u((()=>t.column),(()=>{G()})),(e,t)=>{const i=W;return d(),h(c,null,[g("div",{class:"Wallfall-container",ref_key:"containerRef",ref:a,onScroll:t[0]||(t[0]=(...e)=>m(B)&&m(B)(...e))},[g("div",{class:"list",style:p(F.value)},[q.value?(d(!0),h(c,{key:0},f(S.value,(({item:t,style:a,imageHeight:i})=>(d(),h("div",{class:"item",style:p(a),key:t.id},[_(e.$slots,"item",{item:t,imageHeight:i},void 0,!0)],4)))),128)):(d(),h("div",R,[(d(!0),h(c,null,f(x.value,(({item:t,style:a,imageHeight:i})=>(d(),h("div",{style:p(a)},[_(e.$slots,"item",{item:t,imageHeight:i},void 0,!0)],4)))),256))]))],4)],544),v(i,{title:"回到顶部",right:35,bottom:50,"visibility-height":300,target:".Wallfall-container"},{default:y((()=>[v(m($))])),_:1})],64)}}}),[["__scopeId","data-v-db5a796a"]]),T=["#409EFF","#67C23A","#E6A23C","#F56C6C","#909399"];function P(){return T[(e=0,t=4,Math.floor(Math.random()*(t-e+1))+e)];var e,t}const D=async()=>b.request("get","/notes").then((({data:e})=>e.items.map((e=>({id:e.id,width:e.note_card.cover.width,height:e.note_card.cover.height,title:e.note_card.display_title,author:e.note_card.user.nickname,bgColor:P()}))))),O={class:"content"},B={class:"notesItem"},G={class:"notesFooter"},V={class:"title"},Y={class:"author"},Z={class:"author-info"},J={class:"name"},K=A(e({__name:"index",setup(e){const t=async(e,t)=>new Promise((a=>{setTimeout((()=>{a(D().then((a=>a.slice((e-1)*t,(e-1)*t+t))))}),1e3)})),i=l(null),s=new ResizeObserver((e=>{u(e[0].target.clientWidth)})),n=l(5),u=e=>{n.value=e>960?5:e>=690&&e<960?4:e>=500&&e<690?3:2};return r((()=>{s.observe(i.value)})),o((()=>{s.unobserve(i.value)})),(e,l)=>{const s=k,r=S,o=E,u=C("auth");return d(),h("div",O,[v(o,{shadow:"never",class:"mb-2"},{default:y((()=>[v(r,{wrap:""},{default:y((()=>[v(m(I),{value:"permission:btn:add"},{default:y((()=>[v(s,{plain:"",type:"warning"},{default:y((()=>l[0]||(l[0]=[z(" 新增(组件方式控制权限) ")]))),_:1})])),_:1}),m(a)("permission:btn:add")?(d(),H(s,{key:0,plain:"",type:"warning"},{default:y((()=>l[1]||(l[1]=[z(" 新增(函数方式控制权限) ")]))),_:1})):x("",!0),q((d(),H(s,{plain:"",type:"warning"},{default:y((()=>l[2]||(l[2]=[z(" 新增(指令方式控制权限) ")]))),_:1})),[[u,"permission:btn:add"]])])),_:1})])),_:1}),g("div",{ref_key:"containerRef",ref:i},[v(j,{request:t,gap:20,"page-size":15,column:n.value,"enter-size":2*n.value},{item:y((({item:e,imageHeight:t})=>[g("div",B,[g("div",{style:p({height:t+"px",width:"100%",border:"1px solid #eee",borderRadius:"20px",backgroundColor:e.bgColor})},null,4),g("div",G,[g("div",V,F(e.title),1),g("div",Y,[g("div",Z,[g("div",{class:"avatar",style:p({backgroundColor:e.bgColor})},null,4),g("span",J,F(e.author),1)]),l[3]||(l[3]=g("div",{class:"like"},"100",-1))])])])])),_:1},8,["column","enter-size"])],512)])}}}),[["__scopeId","data-v-9f6a92e7"]]);export{K as default};
