import{d as e,B as t,az as a,s as i,l,f as s,aA as n,z as r,A as o,v as u,W as h,o as d,I as c,X as g,a3 as v,a as m,al as p,an as f,w as y,U as _,r as w,aB as b,c as H,am as x,G as k,aC as z,Z as q,$ as C,ap as F}from"./index-Di92kVg-.js";import{E as $}from"./el-card-Cu1GCfAR.js";import{E as A}from"./el-space-CQZsxoKg.js";import{E,b as W}from"./back_top-B85IpdGO.js";import{_ as I}from"./_plugin-vue_export-helper-BCo6x5W8.js";const S=e({name:"Auth",props:{value:{type:void 0,default:[]}},setup:(e,{slots:i})=>()=>i&&a(e.value)?t("Fragment",null,null==i?void 0:i.default()):null}),M=i({loading:!1,isFinish:!1,currentPage:1,list:[]});const R={key:1,id:"temporary-list"},j=I(e({__name:"index",props:{gap:{},column:{},pageSize:{},request:{type:Function},enterSize:{}},setup(e){const t=e,a=l(null),b=i({viewWidth:0,viewHeight:0,start:0}),H=s((()=>b.viewHeight+b.start)),x=l([]),k=l(!1),z=i({queue:Array(t.column).fill(0).map((()=>({list:[],height:0}))),len:0}),q=s((()=>{let e=0,t=1/0,a=-1/0;return z.queue.forEach((({height:i},l)=>{i<t&&(t=i,e=l),i>a&&(a=i)})),{minIndex:e,minHeight:t,maxHeight:a}})),C=s((()=>({height:`${q.value.maxHeight}px`}))),F=s((()=>z.len<M.list.length)),$=s((()=>z.queue.reduce(((e,{list:t})=>e.concat(t)),[]))),A=s((()=>$.value.filter((e=>e.h+e.y>b.start&&e.y<H.value)))),I=(e,a,i)=>{const l=S.value.get(e.id),s=l.width,n=l.height;let r=0;return null!==a&&(r=a.y+a.h+t.gap),{item:e,y:r,h:n,imageHeight:l.imageHeight,style:{width:`${s}px`,height:`${n}px`,transform:`translate3d(${0===i?0:(s+t.gap)*i}px,${r}px,0)`}}},S=l(new Map),j=()=>{S.value=M.list.reduce(((e,a)=>{const i=Math.floor((b.viewWidth-t.gap*(t.column-1))/t.column),l=S.value.get(a.id);return e.set(a.id,{width:i,height:l?l.height:0,imageHeight:Math.floor(i*a.height/a.width)}),e}),new Map)},T=(e=t.enterSize)=>{if(F.value){k.value=!1;for(let t=0;t<e;t++){const e=M.list[z.len+t];if(!e)break;const a=S.value.get(e.id);x.value.push({item:e,y:0,h:0,imageHeight:a.imageHeight,style:{width:`${a.width}px`}})}_((()=>{const e=document.querySelector("#temporary-list");Array.from(e.children).forEach(((e,t)=>{const a=e.getBoundingClientRect();x.value[t].h=a.height})),B(),k.value=!0,(e=>{for(let t=0;t<e;t++){const e=q.value.minIndex,t=z.queue[e],a=t.list[t.list.length-1]||null,i=M.list[z.len]||null;if(i){const l=I(i,a,e);t.list.push(l),t.height=l.y,z.len++}}})(x.value.length),x.value=[]}))}},B=()=>{x.value.forEach((({item:e,h:t})=>{const a=S.value.get(e.id);S.value.set(e.id,{...a,height:t})}))},P=async()=>{b.viewWidth=a.value.clientWidth,b.viewHeight=a.value.clientHeight,b.start=a.value.scrollTop},O=async()=>{if(M.isFinish)return;M.loading=!0;const e=await t.request(M.currentPage++,t.pageSize);if(e.length)return M.list.push(...e),M.loading=!1,e;M.isFinish=!0},D=function(e,t){let a=null;return function(...i){a||(e.apply(this,i),a=setTimeout((()=>{a=null}),t))}}((()=>{const{scrollTop:e,clientHeight:t}=a.value;b.start=e,M.loading||F.value||O().then((e=>{e&&j(),e&&T()})),e+t>q.value.minHeight&&T()}),1e3),G=n((()=>{P(),z.queue=Array(t.column).fill(0).map((()=>({list:[],height:0}))),z.len=0,j(),T(t.pageSize)}),300),U=new ResizeObserver((()=>{G()}));return r((async()=>{(async()=>{P();const e=await O();j(),e&&T(e.length)})(),U.observe(a.value)})),o((()=>{U.unobserve(a.value)})),u((()=>t.column),(()=>{G()})),(e,t)=>{const i=E;return d(),h(c,null,[g("div",{class:"Wallfall-container",ref_key:"containerRef",ref:a,onScroll:t[0]||(t[0]=(...e)=>m(D)&&m(D)(...e))},[g("div",{class:"list",style:p(C.value)},[k.value?(d(!0),h(c,{key:0},f(A.value,(({item:t,style:a,imageHeight:i})=>(d(),h("div",{class:"item",style:p(a),key:t.id},[w(e.$slots,"item",{item:t,imageHeight:i},void 0,!0)],4)))),128)):(d(),h("div",R,[(d(!0),h(c,null,f(x.value,(({item:t,style:a,imageHeight:i})=>(d(),h("div",{style:p(a)},[w(e.$slots,"item",{item:t,imageHeight:i},void 0,!0)],4)))),256))]))],4)],544),v(i,{title:"回到顶部",right:35,bottom:50,"visibility-height":300,target:".Wallfall-container"},{default:y((()=>[v(m(W))])),_:1})],64)}}}),[["__scopeId","data-v-96908d5e"]]),T=["#409EFF","#67C23A","#E6A23C","#F56C6C","#909399"];function B(){return T[(e=0,t=4,Math.floor(Math.random()*(t-e+1))+e)];var e,t}const P=async()=>b.request("get","/notes").then((({data:e})=>e.items.map((e=>({id:e.id,width:e.note_card.cover.width,height:e.note_card.cover.height,title:e.note_card.display_title,author:e.note_card.user.nickname,bgColor:B()}))))),O={class:"content"},D={class:"notesItem"},G={class:"notesFooter"},U={class:"title"},X={class:"author"},Z={class:"author-info"},J={class:"name"},K=I(e({__name:"index",setup(e){const t=async(e,t)=>new Promise((a=>{setTimeout((()=>{a(P().then((a=>a.slice((e-1)*t,(e-1)*t+t))))}),1e3)})),i=l(null),s=new ResizeObserver((e=>{u(e[0].target.clientWidth)})),n=l(5),u=e=>{n.value=e>960?5:e>=690&&e<960?4:e>=500&&e<690?3:2};return r((()=>{s.observe(i.value)})),o((()=>{s.unobserve(i.value)})),(e,l)=>{const s=z,r=A,o=$,u=F("auth");return d(),h("div",O,[v(o,{shadow:"never",class:"mb-2"},{default:y((()=>[v(r,{wrap:""},{default:y((()=>[v(m(S),{value:"permission:btn:add"},{default:y((()=>[v(s,{plain:"",type:"warning"},{default:y((()=>l[0]||(l[0]=[q(" 新增(组件方式控制权限) ")]))),_:1,__:[0]})])),_:1}),m(a)("permission:btn:add")?(d(),H(s,{key:0,plain:"",type:"warning"},{default:y((()=>l[1]||(l[1]=[q(" 新增(函数方式控制权限) ")]))),_:1,__:[1]})):x("",!0),k((d(),H(s,{plain:"",type:"warning"},{default:y((()=>l[2]||(l[2]=[q(" 新增(指令方式控制权限) ")]))),_:1,__:[2]})),[[u,"permission:btn:add"]])])),_:1})])),_:1}),g("div",{ref_key:"containerRef",ref:i},[v(j,{request:t,gap:20,"page-size":15,column:n.value,"enter-size":2*n.value},{item:y((({item:e,imageHeight:t})=>[g("div",D,[g("div",{style:p({height:t+"px",width:"100%",border:"1px solid #eee",borderRadius:"20px",backgroundColor:e.bgColor})},null,4),g("div",G,[g("div",U,C(e.title),1),g("div",X,[g("div",Z,[g("div",{class:"avatar",style:p({backgroundColor:e.bgColor})},null,4),g("span",J,C(e.author),1)]),l[3]||(l[3]=g("div",{class:"like"},"100",-1))])])])])),_:1},8,["column","enter-size"])],512)])}}}),[["__scopeId","data-v-27c6f1ab"]]);export{K as default};
